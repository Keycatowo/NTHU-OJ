# 12233 - Mine the Crystal

## Description
最近 Shin 在召喚峽谷發現了一處擁有無限產量的神祕水晶礦場，在稍微探勘之後，Shin 決定把水晶含藏量豐富的地點規劃成了一間間的水晶礦坊，並且把開採出的水晶透過舖設在各水晶礦坊之間的礦車軌道 (指定單向通行) 運送。在重新檢視水晶礦場格局圖時，Shin 發現它恰巧是一張有向無環圖 (Directed Acyclic Graph)。而身為魔法師的 Shin 沒道理用物理攻擊開採水晶，所以 Shin 以水晶為代價召喚出小精靈們來幫他開採水晶 ( k 單位體積的水晶能召喚出 k 單位體積的小精靈，k 為正整數 )。

因為整個水晶礦場規模浩大，所以 Shin 請來其他魔法師跟水晶礦場工頭，共同開發一套讓這些小精靈們能有效率地開採水晶的演算法：

假設整座礦場中有 x 間無法透過礦車軌道抵達的水晶礦坊。針對這些水晶礦坊，Shin 必須一開始先花費 x 單位的水晶來召喚出 x 隻 1 單位體積的小精靈，並使用傳送魔法往每一間這樣的水晶礦坊都送進一隻小精靈。小精靈們在水晶礦坊間的移動由 Shin 來當總指揮，透過心電感應的方式傳達指令。但小精靈們生性貪玩、時常罷工，所以必須制定遊戲規則來誘使它們認為這是一場挖礦遊戲。

規則一：
小精靈們往目標水晶礦坊移動。
目標水晶礦坊的定義是：
(1) 該水晶礦坊還沒有小精靈進駐。
(2) 跟該水晶礦坊相鄰的水晶礦坊都已經有小精靈進駐。
※ 假設有一水晶礦坊 C，C 的相鄰水晶礦坊們即是只透過一條水晶礦坊間的礦車軌道就能到達 C 的那些水晶礦坊所成的集合。

規則二：
小精靈們在接受移動指令後，必須先在原水晶礦坊開挖出總體積跟自己體積相等的水晶量後，召喚出另一隻跟自己體積相等的小精靈。原先開採的小精靈留在原水晶礦坊待命，新召喚出的小精靈往目標水晶礦坊移動。

規則三：
到達目標水晶礦坊的小精靈們會被施展融合魔法，並合體成為新的小精靈個體，新的小精靈個體的體積即為所有參與融合的小精靈們的體積總和。但很殘念地，Shin 的召喚技能還沒點滿，所以 Shin 能操控的每隻小精靈，個體體積只能小於 106 單位體積 (含)。一旦融合之後的新個體體積超過 106 單位體積，新的小精靈個體體積會縮水到 106 單位體積，多餘的體積會轉換成魔力散失。

規則四：
當所有水晶礦坊都被小精靈們進駐後，Shin 再使用傳送魔法召回所有小精靈，並使用轉化魔法將小精靈們變回水晶 。

整個故事最殘念的事情是，召喚峽谷沒有人會寫程式，所以請你幫 Shin 寫一個程式來幫他計算最後水晶的最大化淨收穫是多少單位體積。


## Input
輸入檔第一行是一個整數 T ，表示有 T 組測資。

接著是 T 組測資的內容，每組測資的格式是：

(1) 第一行：
兩個以空白隔開的整數，V 和 E，
表示整個水晶礦場中有 V 處水晶礦坊以及 E 條礦車軌道。

(2) 接下來的 E 行中的每一行：
兩個以空白隔開的整數 ，ui 和 vi，
表示存在一條由編號 ui 水晶礦坊到編號 vi 水晶礦坊的礦車軌道。

1 ≦ T ≦ 10
1 ≦ V ≦ 1000
0 ≦ E ≦ V(V-1)/2

```
2

6 6 // V E
1 2
0 2
2 3
2 4
1 5
5 4

6 7 // V E
0 1
0 2
1 3
1 4
2 3
2 4
3 5
```
## Output
對於每組測資請輸出預期淨收穫並換行。
```
8
8
```

## 解題過程
1. 節點：
   1. int index儲存節點編號
   2. int magic儲存精靈數量
2. 圖：
   1. List* pre_neighbor  儲存每個節點的上游List
   2. List* next_neighbor 儲存每個節點的下游List
   3. bool visited 記錄節點是否已經運算過(初始全部設為false)
3. 運算
   1. 初始化：將所有上游List為空的節點magic設為1，visited[Node->index]設為true，計算數量為int spend。
   2. 用Queue儲存待處理節點，一開始將所有上游為空的節點的下游節點push進去。
   3. 對於Queue內的節點，先檢查是未運算過(visited[Q.front()])，如果運算過就pop掉忽略即可。
   4. 如果節點未運算，檢查其上游List是否其中所有節點都運算過
      1. 如果是的話，將這個節點的magic設為所有上游節點magic合併，檢查上限，設為已運算。
      2. 如果不是， **還在想要不要push回去，這樣可以確保不漏掉，但不確定是否會太冗**。
   5. 當Queue空了的時候，即表示所有節點都運算過取得magic值了
   6. 計算所有magic值總和 - spend 輸出即為結果
